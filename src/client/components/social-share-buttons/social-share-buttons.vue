<template>
  <div>
    <p v-if="title" class="social-share-buttons__text body">{{ title }}</p>
    <app-button
      v-if="hasNativeShare"
      label="Share"
      small
      @click="shareNative"
    />
    <ul
      v-else
      class="social-share-buttons__list"
    >
      <li
        class="social-share-buttons__list-icon"
        v-for="item in socials"
        :key="item.href"
      >
        <a
          :href="item.href"
          target="_blank"
          rel="noreferrer noopener"
          :aria-label="item.label"
          @click="trackShare(item.label)"
        >
          <app-icon :name="item.icon" is-large :alt="item.alt" />
        </a>
      </li>
    </ul>
  </div>
</template>

<script>
  export default {
    props: {
      baseUrl: {
        type: String,
        required: true,
      },
      authors: {
        type: Array,
        default: null,
      },
      title: {
        type: String,
        default: '',
      },
      twitterTitle: {
        type: String,
        default: '',
      },
    },
    data () {
      return {
        hasNativeShare: false,
        url: new URL(this.$route.fullPath, this.baseUrl)
      }
    },
    computed: {
      blogAuthors () {
        return this.authors.map(author => {
          return author.twitterHandle ? author.twitterHandle : author.name
        }).join(' ')
      },
      socials () {
        return [
          { icon: 'twitter',
            href: `https://twitter.com/intent/tweet?text=${this.twitterTitle} by ${this.blogAuthors} @devoorhoede&url=${this.url}`,
            label: 'twitter',
            alt: 'Share this post on Twitter',
          },
          { icon: 'facebook',
            href: `https://www.facebook.com/sharer.php?u=${this.url}`,
            label: 'facebook',
            alt: 'Share this post on Facebook',
          },
          {
            icon: 'linkedin',
            href: `https://www.linkedin.com/shareArticle?&url=${this.url}&title=${this.title}`,
            label: 'linkedin',
            alt: 'Share this post on LinkedIn'
          }
        ]
      },
    },
    created () {
      this.$nextTick(() => {
        if (process.client) {
          this.hasNativeShare = (typeof window.navigator.share === 'function')
          this.url = window.location.href
        }
      })
    },
    methods: {
      shareNative () {
        this.$gtag('event', 'social share', {
          'event_category': 'native',
          'event_label': this.url,
          'value': 0,
        })
        return navigator.share({ url: this.url })
      },
      trackShare(platform) {
        this.$gtag('event', 'social share', {
          'event_category': platform,
          'event_label': this.url,
          'value': 0
        })
      },
    },

  }
</script>

<style>
  .social-share-buttons__text {
    display: none;
  }

  .social-share-buttons__list-icon {
    display: inline-block;
    margin-right: var(--spacing-small);
    color: var(--html-blue);
  }

  .social-share-buttons__list-icon:last-of-type {
    margin: 0;
  }

  @media (min-width: 720px) {
    .social-share-buttons__text {
      display: block;
      margin-bottom: var(--spacing-smaller);
    }

    .social-share-buttons__list-icon:last-of-type {
      margin: 0;
    }
  }
</style>
