<template>
  <main
    id="content"
    class="page-index"
    tabindex="-1"
  >
    <div class="page-index__header">
      <page-header
        fill-screen
        curly-bracket
        :byline="page.headerTitle"
        :headline="page.subtitle"
        :image="page.headerIllustration"
        is-animated
        :animation-delay="pageHeaderAnimationDelay"
      />
    </div>
    <page-introduction :sections="page.pageIntroductionSections" />
    <section class="page-index__cta grid">
      <cta-block v-if="ctaSectionTop" :item="ctaSectionTop"/>
    </section>
    <section class="page-index__services grid">
      <h2 class="page-index__section-title h1">{{ page.servicesHeader }}</h2>
      <services-list class="page-index__services-list" :services="page.services" />
      <div class="page-index__blog-posts-button">
        <app-button
          secondary
          :label="$t('all_services')"
          :to="localeUrl('services')"
        />
      </div>
    </section>
    <section class="page-index__cases grid">
      <h2 class="page-index__section-title page-index__section-title--cases h1">{{ page.casesTitle }}</h2>
      <horizontal-carousel>
        <template slot="slides">
          <case-excerpt
            v-for="caseExcerpt in page.cases"
            :key="caseExcerpt.slug"
            :slug="caseExcerpt.slug"
            :image="caseExcerpt.caseTeaser.image"
            :title="caseExcerpt.title"
            :body="caseExcerpt.subtitle"
          />
        </template>
      </horizontal-carousel>
      <div class="page-index__blog-posts-button">
        <app-button
          :label="$t('all_cases')"
          :to="localeUrl('cases')"
        />
      </div>
    </section>
    <highlighted-clients :title="page.clientsTitle" />
    <div class="page-index__academy grid" v-if="upcomingEvents[0]">
      <academy-excerpt
        :date="upcomingEvents[0].date"
        :title="upcomingEvents[0].title"
        :description="upcomingEvents[0].description"
        :illustration="page.academyIllustration"
        :link="upcomingEvents[0].url"
      />
      <curly-bracket />
    </div>
    <section class="page-index__blog-posts grid">
      <h2 class="page-index__section-title page-index__section-title--blog-posts h3">{{ $t('latest_blog_posts') }}</h2>
      <ul class="page-index__blog-posts-list grid">
        <li v-for="blogPost in latestBlogposts" :key="blogPost.slug" class="page-index__blog-posts-list-item">
          <blog-list-item :item="blogPost" />
        </li>
      </ul>
      <div class="page-index__blog-posts-button">
        <app-button
          :to="localeUrl('blog')"
          :label="$t('latest_blog_posts')"
          secondary
        />
      </div>
      <curly-bracket side="right" />
    </section>
    <section class="page-index__pivots grid">
      <pivot-list
        v-if="page.pivots && page.pivots.length"
        :pivots="page.pivots"
      />
      <div class="page-index__scroll-to">
        <scroll-to direction="up" />
      </div>
    </section>
  </main>
</template>

<script>
  import asyncData from '~/lib/async-page'
  import getSelfTypingTextInterval from '~/lib/get-self-typing-text-interval'
  import head from '~/lib/seo-head'

  export default {
    asyncData,
    computed: {
      ctaSectionTop() {
        return this.page.pageCtaSection[0]
      },
      selfTypingTextInterval() {
        return getSelfTypingTextInterval(this.page.subtitle) / 1000
      },
      pageHeaderAnimationDelay() {
        return this.page.subtitle.length * this.selfTypingTextInterval
      }
    },
    methods: {
      isLast(index, usps) {
        return index === Object.keys(usps).length - 1 ? { isSet: true, number: index } : { isSet: false }
      },
      isFirst(index) {
        return index === 0 ? { isSet: true, number: 0 } : { isSet: false }
      }
    },
    head,
  }
</script>

<style>
  .page-index .page-introduction {
    margin-bottom: var(--spacing-larger);
  }

  .page-index__services {
    margin-bottom: var(--spacing-larger);
  }

  .page-index__section-title {
    margin-bottom: var(--spacing-large);
    grid-row-start: 1;
    grid-row-end: 2;
    text-align: center;
  }

  .page-index__cta {
    margin-bottom: var(--spacing-larger);
  }

  .page-index__section-title--blog-posts {
    margin-bottom: var(--spacing-medium);
    grid-row: 1;
  }

  .page-index__section-title--cases {
    margin-bottom: calc(var(--spacing-large) - var(--spacing-smaller));
  }

  .page-index__academy {
    margin-bottom: var(--spacing-large);
    padding: var(--spacing-larger) 0;
    background-color: var(--bg-pastel);
  }

  .page-index .academy-excerpt {
    grid-column: var(--grid-page);
    grid-row: 1;
  }

  .page-index__blog-posts {
    grid-template-rows: repeat(3, auto);
    margin-bottom: var(--spacing-large);
  }

  .page-index__blog-posts-list {
    margin-bottom: var(--spacing-small);
    grid-row: 2;
    grid-column: var(--grid-content-start) / 48;
    grid-template-rows: repeat(3, auto);
  }

  .page-index__blog-posts-list-item {
    grid-row: 1;
  }

  .page-index__blog-posts-list-item:nth-child(2) {
    grid-row: 2;
  }

  .page-index__blog-posts-list-item:nth-child(3) {
    grid-row: 3;
  }

  .page-index__blog-posts-button {
    display: flex;
    justify-content: center;
    grid-row: 3;
  }

  .page-index__cases {
    margin-bottom: var(--spacing-larger);
  }

  .page-index__cases .horizontal-carousel {
    margin-bottom: var(--spacing-medium);
    grid-column: var(--grid-content);
    grid-row: 2;
  }

  .page-index__pivots {
    position: relative;
  }

  .page-index__pivots .newsletter-form {
    background-color: var(--bg-pastel);
  }

  .page-index__scroll-to {
    display: none;
    position: absolute;
    left: 0;
    right: 0;
    bottom: 55px;
    grid-column-start: -2;
    grid-column-end: -3;
  }

  @media (min-width: 650px) {
    .page-index .page-introduction {
      margin-bottom: var(--spacing-bigger);
    }
  }

  @media (min-width: 720px) {
    .page-index .scroll-text {
      padding-top: var(--spacing-big);
    }

    .page-index__cases {
      margin-bottom: var(--spacing-bigger);
    }

    .page-index__cases .horizontal-carousel__slides {
      padding-bottom: 0;
    }

    .page-index__section-title {
      margin-bottom: var(--spacing-larger);
    }

    .page-index__section-title--blog-posts {
      margin-bottom: var(--spacing-medium);
      grid-column-start: 14;
      text-align: left;
    }

    .page-index__services {
      margin-bottom: var(--spacing-bigger);
    }

    .page-index__services-list {
      margin-bottom: var(--spacing-large);
    }

    .page-index__cta {
      margin-bottom: var(--spacing-bigger);
    }

    .page-index__cta .pivot {
      border-top: none;
      border-bottom: 1px solid var(--very-dim);
    }

    .page-index__blog-posts {
      position: relative;
      margin-bottom: var(--spacing-big);
    }

    .page-index__blog-posts-list {
      grid-column: var(--grid-page);
      overflow: hidden;
    }

    .page-index__blog-posts-list-item {
      transition: transform var(--blog-list-item-animation-timing) ease-out;
      display: inline-block;
      grid-column-start: 8;
      grid-column-end: 30;
    }

    .page-index .blog-list-item__time {
      grid-column-start: 9;
      grid-column-end: 14;
      text-align: right;
    }

    .page-index .blog-list-item__details {
      grid-column-start: 14;
      grid-column-end: 31;
      margin-right: 0;
    }

    .page-index__academy {
      padding: 0;
      position: relative;
    }

    .page-index__academy .curly-bracket {
      margin-top: 0;
    }

    .page-index .academy-excerpt {
      padding: var(--spacing-larger) 0;
    }

    .page-index__pivots .pivot {
      grid-column-start: 6;
      grid-column-end: 46;
    }

    .page-index__scroll-to {
      display: block;
    }
  }

  @media (min-width: 720px) and (max-width: 1100px) {
    .page-index__cases .case-excerpt__title {
      font-size: 1.15rem;
    }
  }

  @media (min-width: 1100px) {
    .page-index .page-introduction {
      margin-bottom: var(--spacing-huge);
    }

    .page-index .scroll-text {
      padding-top: var(--spacing-bigger);
    }

    .page-index__section-title {
      margin-bottom: var(--spacing-big);
    }

    .page-index__section-title--blog-posts {
      margin-bottom: var(--spacing-medium);
      grid-column-start: 21;
    }

    .page-index__cases {
      margin-bottom: var(--spacing-huge);
    }

    .page-index .blog-list-item__time {
      grid-column-start: 16;
      grid-column-end: 21;
    }

    .page-index__blog-posts-list-item {
      grid-column-start: 16;
      grid-column-end: 45;
    }

    .page-index .blog-list-item__details {
      grid-column-start: 21;
      grid-column-end: 40;
    }
  }

  @media (min-width: 1440px) {
    .page-index__pivots {
      /* tweak for the inconsistent spacing of the latest-blog-post component  */
      padding-top: var(--spacing-smaller);
    }
  }

  @media (min-width: 1920px) {
    .page-index .page-header--home {
      height: 1000px;
    }
  }
</style>
